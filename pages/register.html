<!DOCTYPE html>
<html>
    <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
      <link rel="stylesheet" href="../styles/reset.css">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
      <link href="../styles/generalStyle.css" rel="stylesheet">
      <title>Dog Walking</title>
  
      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" defer></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous" defer></script>
    </head>
    
    <body data-aos-easing="ease" data-aos-duration="400" data-aos-delay="0" style="background:#349D90";>

      <header>

        <nav class="navbar navbar-standard navbar-expand-lg fixed-top navbar-light navbar-fixed-top navbar-glass-shadow" data-navbar-darken-on-scroll="data-navbar-darken-on-scroll" style="background-image: none; font-family: 'Futura', Nunito, Intertype, Jost, Spartan, Trebuchet MS, Arial, sans-serif;">

            <div class="container" style="font-family: 'Futura', Nunito, Intertype, Jost, Spartan, Trebuchet MS, Arial, sans-serif; font:bolder;">

                <a class="navbar-brand dark__text-white" href="homepage.html" style="font-family: 'Futura', Nunito, Intertype, Jost, Spartan, Trebuchet MS, Arial, sans-serif; font-size:xx-large; color: white;">Pet Minder 20</a>

                <button class="navbar-toggler" style="border-color: #349D90; background: white;" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon navbar-light"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarTogglerDemo02">

                    <ul class="navbar-nav ms-auto">

                        <li class="nav-item">
                            <a class="nav-link" href="homepage.html" style="color: white; font-family: 'Futura', Nunito, Intertype, Jost, Spartan, Trebuchet MS, Arial, sans-serif;">Home</a>
                        </li>


                        <li class="nav-item">
                          <a class="nav-link" href="login.html" style="color: white; font-family: 'Futura', Nunito, Intertype, Jost, Spartan, Trebuchet MS, Arial, sans-serif;" >Login</a>
                      </li>

                    </ul>

            </div>

        </nav>
        
    </header>     


        <br>

        <div class="container mt-5"  style="font-family: 'Futura', Nunito, Intertype, Jost, Spartan, Trebuchet MS, Arial, sans-serif; font:bolder; color: white;">
            <h1 class="text-center mb-4"><b>Register</b></h1>
            <form onsubmit="signup(event)">
                <div id="form_content_inner_container" class="mb-3">
                    <label for="firstName" class="form-label"><h2>First Name</h2></label>
                    <input type="text" class="form-control" id="firstName" placeholder="First Name">
                    
                    <br>

                    <label for="lastName" class="form-label"><h2>Last Name</h2></label>
                    <input type="text" class="form-control" id="lastName" placeholder="Last Name">

                    <br>

                    <label for="options">Choose a option:</label>
                    <br>
                    <select name="option" id="option">
                        <option value="client">Client</option>
                        <option value="minder">Minder</option>
                    </select>

                    <br>
                    <label for="email" class="form-label mt-3"><h2>Email</h2></label>
                    <input type="email" class="form-control" id="email" placeholder="Email">

                    <br>
                    <label for="text" class="form-label mt-3"><h2>Phone Number</h2></label>
                    <input type="text" class="form-control" id="phoneNumber" placeholder="Phone Number">
                    <br>

                    <label for="password" class="form-label mt-3"><h2>Password</h2></label>
                    <input type="password" class="form-control" id="password" placeholder="Password">
                </div>
            <div id="form_button_container" class="text-center">
                <button id="signupinp" type="submit" class="btn btn-primary" value="Register">Register</button>
            </div>
        </form>
    </div>    
</body>

<footer class="text-center text-lg-start bg-white text-muted">
  <!-- Section: Links  -->
  <section class="bg-black">
    <div class="container text-center text-md-start mt-5" style="padding-top:2em;">
      <!-- Grid row -->
      <div class="row mt-3">
        <!-- Grid column -->
        <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4 text-center">
          <!-- Content -->
          <h6 class="text-uppercase fw-bold mb-4">
            <i class="fas fa-gem me-3 text-secondary"></i>Pet Minder 20
          </h6>
          <p>
              10% done lads lets get this done quickly
          </p>
        </div>
        <!-- Grid column -->

        <!-- Grid column -->
        <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4 text-center">
          <!-- Links -->
          <h6 class="text-uppercase fw-bold mb-4">
            Links
          </h6>
          <p>
            <a href="" class="text-reset">login page</a>
          </p>
          <p>
              <a href="#top" class="text-reset">Back to top</a>
          </p>
        </div>
        <!-- Grid column -->
  

        <!-- Grid column -->
        <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4 text-center">
          <!-- Links -->
          <h6 class="text-uppercase fw-bold mb-4">Contact</h6>
            <i class="fas fa-envelope me-3 text-secondary"></i>
            fakeemail@group20.com
        </div>
        <!-- Grid column -->
      </div>
      <!-- Grid row -->
    </div>
  </section>

  <div class="text-center p-4 bg-dark">
      Â© Group 20
  </div>
  <!-- Section: Links  -->
</footer>
<!-- Footer -->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="../javascript/navBar.js"></script>
<!-- <script src="../javascript/signUpUsers.js" type="module"></script> -->


<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js';
  import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.18.0/firebase-auth.js';
  import { getDatabase, ref, set, get, query, orderByChild, equalTo } from 'https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js';


  const firebaseConfig = {
    apiKey: "AIzaSyBHIHD0PDT5IPyomztjZXjGY3_AdTsIfj0",
    authDomain: "qm-se-20.firebaseapp.com",
    databaseURL: "https://qm-se-20-default-rtdb.firebaseio.com",
    projectId: "qm-se-20",
    storageBucket: "qm-se-20.appspot.com",
    messagingSenderId: "830582484400",
    appId: "1:830582484400:web:c2a7f77ab61f1344f03a75"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);


  function signup(event) {
  event.preventDefault();

  var firstName = document.getElementById("firstName").value;
  var lastName = document.getElementById("lastName").value;
  var o = document.getElementById("option");
  var chosenOption = o.options[o.selectedIndex].text;
  var email = document.getElementById("email").value;
  var phoneNumber = document.getElementById("phoneNumber").value;
  var password = document.getElementById("password").value;

  // Call the validateInputs function
  const validationResult = validateInputs(firstName, lastName, phoneNumber, password);
  const { pass, errorMessages } = validationResult;

  // Show error messages if validation fails
  if (!pass) {
    alert(errorMessages.join("\n"));
  } else {
    // If validation passes, proceed with creating the user
    createUserWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        const user = userCredential.user;

        // Set user data in the database
        set(ref(db, `users/${user.uid}`), {
          firstName: firstName,
          lastName: lastName,
          phoneNumber: phoneNumber,
          chosenOption: chosenOption,
          email: email,
          uid: user.uid,
        });
        window.location.href = "login.html";
        // Redirect to a success page
      })
      .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
        alert(errorMessage);
      });
  }
}

function validateInputs(firstName, lastName, phoneNumber, password) {
  var regName = /^[A-Z][a-z]*$/;
  var regPhone = /^(?:(?:\+|00)44\s?[1-9]{1}\d{1,4}\s?\d{1,6}|0\d{2,4}\s?\d{1,6})$/;
  var regPass = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*()-+])[A-Za-z\d!@#$%^&*()-+]{6,}$/;

  var errorMessages = [];
  var pass = true;

  if (!regName.test(firstName)) {
    errorMessages.push("Invalid first name given.");
    pass = false;
  }
  if (!regName.test(lastName)) {
    errorMessages.push("Invalid last name given.");
    pass = false;
  }
  if (!regPhone.test(phoneNumber)) {
    errorMessages.push("Invalid UK phone number given.");
    pass = false;
  }
  if (!regPass.test(password)) {
    errorMessages.push("Invalid password. The password must contain at least one uppercase letter, one lowercase letter, one digit, one special character, and have a minimum length of 6 characters.");
    pass = false;
  }

  return { pass, errorMessages };
}
  document.getElementById("signupinp").addEventListener("click", signup);
</script>

</html>
